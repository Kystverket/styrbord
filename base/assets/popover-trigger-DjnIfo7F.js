'use client';
import{j as P}from"./jsx-runtime-BjG_zV1W.js";import{aF as A,aG as D,aH as F,aI as K,aJ as N,aK as q}from"./Card-KeqL4nDM.js";import{S as k}from"./index-DtgyEQ7Q.js";import{c as B}from"./lite-DaUVFjkg.js";import{r as o}from"./index-BWu4c2F4.js";import{u as C}from"./index-BtN5BFRV.js";const G=({children:a})=>{const s=o.useId(),[t,r]=o.useState(s);return P.jsx(E.Provider,{value:{popoverId:t,setPopoverId:r},children:a})};G.displayName="PopoverTriggerContext";const E=o.createContext({}),z=o.forwardRef(function({id:s,className:t,onClose:r,onOpen:n,open:i,variant:v="default",placement:g="top",autoPlacement:m=!0,asChild:$=!1,...I},M){const R=$?k:"div",x=o.useRef(null),S=C([x,M]),{popoverId:j,setPopoverId:w}=o.useContext(E),[T,y]=o.useState(!1),c=i??T;return o.useEffect(()=>{var p;const e=x.current,f=l=>{var b;const d=l.target,h=(b=d==null?void 0:d.closest)==null?void 0:b.call(d,`[popovertarget="${e==null?void 0:e.id}"]`),L=!h&&!(e!=null&&e.contains(d));h&&l.preventDefault(),c&&(h||L)?(y(!1),r==null||r()):!c&&h&&(y(!0),n==null||n())},u=l=>{l.key!=="Escape"||!c||(l.preventDefault(),y(!1),r==null||r())};return(p=e==null?void 0:e.togglePopover)==null||p.call(e,c),document.addEventListener("click",f,!0),document.addEventListener("keydown",u),()=>{document.removeEventListener("click",f,!0),document.removeEventListener("keydown",u)}},[c]),o.useEffect(()=>{const e=x.current,f=document.querySelector(`[popovertarget="${e==null?void 0:e.id}"]`);if(e&&f&&c)return A(f,e,()=>{D(f,e,{placement:g,strategy:"fixed",middleware:[F(u=>{const p=getComputedStyle(u.elements.floating,"::before");return parseFloat(p.height)}),...m?[K({fallbackAxisSideDirection:"start"}),N()]:[],H]}).then(({x:u,y:p})=>{e.style.translate=`${Math.round(u)}px ${Math.round(p)}px`})})},[c,g,s,m]),o.useEffect(()=>{s&&(w==null||w(s))},[s]),P.jsx(R,{className:B("ds-popover",t),id:s||j,popover:"manual","data-variant":v,ref:S,...I})}),H={name:"ArrowPseudoElement",fn(a){const{elements:s,rects:t,placement:r}=a;let n=`${Math.round(t.reference.width/2+t.reference.x-a.x)}px`,i=`${Math.round(t.reference.height/2+t.reference.y-a.y)}px`;switch(t.reference.width>t.floating.width&&(n=`${Math.round(t.floating.width/2)}px`),t.reference.height>t.floating.height&&(i=`${Math.round(t.floating.height/2)}px`),r.split("-")[0]){case"top":i="100%";break;case"right":n="0";break;case"bottom":i="0";break;case"left":n="100%";break}return s.floating.setAttribute("data-placement",r.split("-")[0]),s.floating.style.setProperty("--ds-popover-arrow-x",n),s.floating.style.setProperty("--ds-popover-arrow-y",i),a}},Q=o.forwardRef(function({id:s,inline:t,asChild:r,...n},i){const{popoverId:v}=o.useContext(E),g=r?k:t?"button":q,m=Object.assign({[o.version.startsWith("19")?"popoverTarget":"popovertarget"]:v,...t?{"data-popover":"inline"}:{}},n);return P.jsx(g,{ref:i,...m})});export{z as P,Q as a,G as b};
